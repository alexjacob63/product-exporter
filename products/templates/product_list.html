{% extends 'base.html' %}

{% block title %}
    <title>Product Records</title>
{% endblock %}

{% block content %}
<div id="result"></div>
<table class="table table-striped table-bordered table-sm">
    <thead class="thead-dark">
    {% if page_obj %}
        <tr>
            <th>Product Name</th>
            <th>Product Sku</th>
            <th>Product Description</th>
            <th>Product Availability</th>
            <th>Actions</th>
        </tr>
    {% endif %}
    </thead>
    <tbody>
    {% for product in page_obj %}
    <tr>
        <td>{{ product.name }}</td>
        <td>{{ product.sku }}</td>
        <td>{{ product.description }}</td>
        <td>{{ product.active }}</td>
        <td>
            <a href="{% url 'product-view' product.id %}"><span class="glyphicon glyphicon-pencil" >View</span></a>
            <a href="{% url 'product-update' product.id %}"><span class="glyphicon glyphicon-pencil" >Edit</span></a>
            <a href="{% url 'product-delete' product.id %}">Delete</a>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>
<div class="pagination">
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?page=1{% for key,value in request.GET.items %}{% ifnotequal key 'page' %}&{{ key }}={{ value }}{% endifnotequal %}{% endfor %}">&laquo; first</a>
                <a href="?page={{ page_obj.previous_page_number }}{% for key,value in request.GET.items %}{% ifnotequal key 'page' %}&{{ key }}={{ value }}{% endifnotequal %}{% endfor %}">previous</a>
            {% endif %}

            {% if page_obj %}
                <span class="current">
                    Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
                </span>
            {% endif %}

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% for key,value in request.GET.items %}{% ifnotequal key 'page' %}&{{ key }}={{ value }}{% endifnotequal %}{% endfor %}">next</a>
                <a href="?page={{ page_obj.paginator.num_pages }}{% for key,value in request.GET.items %}{% ifnotequal key 'page' %}&{{ key }}={{ value }}{% endifnotequal %}{% endfor %}">last &raquo;</a>
            {% endif %}
        </span>
</div>
<br>
<br>
<center><a href="{% url 'product-add' %}" class="btn btn-primary">Add New Product</a></center>
<center><a href="{% url 'delete-all' %}" class="btn btn-primary">Delete all Products</a></center>
<script>
if(typeof(EventSource) !== "undefined") {
  var source = new EventSource("/stream/");
  source.onmessage = function(event) {
    document.getElementById("result").innerHTML = "<h3>Products saving in progress</h3><div>" + event.data + "</div><br>";
  };
} else {
  document.getElementById("result").innerHTML = "Sorry, your browser does not support server-sent events...";
}
</script>
{% endblock %}

